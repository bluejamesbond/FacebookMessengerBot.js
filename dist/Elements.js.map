{"version":3,"sources":["../src/Elements.js"],"names":["Elements","_elements","_quickreplies","_listStyle","text","image","subtext","buttons","defaultAction","Array","isArray","from","Error","type","push","quickreplies","listStyle","build","length","elements","e","element","title","image_url","subtitle","toJSON","default_action","attachment","payload","template_type","top_element_style","url","built","quick_replies"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEMA,Q;AACJ,sBAAc;AAAA;;AACZ,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKC,UAAL,GAAkB,IAAlB;AACD;;;;8BAEmD;AAAA,UAA/CC,IAA+C,QAA/CA,IAA+C;AAAA,UAAzCC,KAAyC,QAAzCA,KAAyC;AAAA,UAAlCC,OAAkC,QAAlCA,OAAkC;AAAA,UAAzBC,OAAyB,QAAzBA,OAAyB;AAAA,UAAhBC,aAAgB,QAAhBA,aAAgB;;AAClD,UAAID,OAAJ,EAAa;AACX,YAAI,EAAEA,oCAAF,CAAJ,EAAmC;AACjC,cAAIE,MAAMC,OAAN,CAAcH,OAAd,CAAJ,EAA4B;AAC1BA,sBAAU,kBAAQI,IAAR,CAAaJ,OAAb,CAAV;AACD,WAFD,MAEO;AACL,kBAAMK,MAAM,yBAAN,CAAN;AACD;AACF;AACF;AACD,UAAIJ,aAAJ,EAAmB;AACjBA,sBAAcK,IAAd,GAAqB,SAArB;AACD;;AAGD,WAAKZ,SAAL,CAAea,IAAf,CAAoB,EAACV,UAAD,EAAOC,YAAP,EAAcC,gBAAd,EAAuBC,gBAAvB,EAAgCC,4BAAhC,EAApB;AACA,aAAO,IAAP;AACD;;;oCAEeO,Y,EAAc;AAC5B,UAAIA,YAAJ,EAAkB;AAChB,YAAI,EAAEA,8CAAF,CAAJ,EAA6C;AAC3C,cAAIN,MAAMC,OAAN,CAAcK,YAAd,CAAJ,EAAiC;AAC/BA,2BAAe,uBAAaJ,IAAb,CAAkBI,YAAlB,CAAf;AACD,WAFD,MAEO;AACL,kBAAMH,MAAM,8BAAN,CAAN;AACD;AACF;AACF;;AAED,WAAKV,aAAL,GAAqBa,YAArB;AACD;;;iCAEYC,S,EAAW;AACtB,UAAIA,cAAc,OAAd,IAAyBA,cAAc,SAA3C,EAAsD;AACpD,aAAKb,UAAL,GAAkBa,SAAlB;AACD,OAFD,MAEO;AACL,cAAMJ,MAAM,uDAAN,CAAN;AACD;AACF;;;sCAEiB;AAChB,aAAO,KAAKV,aAAZ;AACD;;;6BAMQ;AAAA;;AACP,UAAMe,QAAQ,SAARA,KAAQ,GAAM;AAClB,YAAI,MAAKhB,SAAL,CAAeiB,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,cAAMC,WAAW,EAAjB;AAD6B;AAAA;AAAA;;AAAA;AAE7B,4DAAgB,MAAKlB,SAArB,4GAAgC;AAAA,kBAArBmB,CAAqB;;AAC9B,kBAAMC,UAAU,EAAhB;AACA,kBAAID,EAAEhB,IAAN,EAAYiB,QAAQC,KAAR,GAAgBF,EAAEhB,IAAlB;AACZ,kBAAIgB,EAAEf,KAAN,EAAagB,QAAQE,SAAR,GAAoBH,EAAEf,KAAtB;AACb,kBAAIe,EAAEd,OAAN,EAAee,QAAQG,QAAR,GAAmBJ,EAAEd,OAArB;AACf,kBAAIc,EAAEb,OAAF,IAAaa,EAAEb,OAAF,CAAUW,MAA3B,EAAmCG,QAAQd,OAAR,GAAkBa,EAAEb,OAAF,CAAUkB,MAAV,EAAlB;AACnC,kBAAIL,EAAEZ,aAAN,EAAqBa,QAAQK,cAAR,GAAyBN,EAAEZ,aAA3B;AACrBW,uBAASL,IAAT,CAAcO,OAAd;AACD;AAV4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAW7B,cAAI,MAAKlB,UAAT,EAAqB;AACnB,mBAAO;AACLwB,0BAAY;AACVd,sBAAM,UADI;AAEVe,yBAAS,EAACC,eAAe,MAAhB,EAAwBC,mBAAmB,MAAK3B,UAAhD,EAA4DgB,kBAA5D;AAFC;AADP,aAAP;AAMD,WAPD,MAOO,IAAI,CAAC,MAAKhB,UAAV,EAAsB;AAC3B,mBAAO,EAACwB,YAAY,EAACd,MAAM,UAAP,EAAmBe,SAAS,EAACC,eAAe,SAAhB,EAA2BV,kBAA3B,EAA5B,EAAb,EAAP;AACD;AACF,SArBD,MAqBO,IAAI,MAAKlB,SAAL,CAAeiB,MAAf,KAA0B,CAA9B,EAAiC;AACtC,cAAME,KAAI,MAAKnB,SAAL,CAAe,CAAf,CAAV;AACA,cAAMoB,WAAU,EAAhB;AACA,cAAID,GAAEhB,IAAF,IAAUgB,GAAEb,OAAZ,IAAuBa,GAAEb,OAAF,CAAUW,MAAjC,KAA4CE,GAAEf,KAAF,IAAWe,GAAEd,OAAzD,CAAJ,EAAuE;AACrEe,qBAAQC,KAAR,GAAgBF,GAAEhB,IAAlB;AACA,gBAAIgB,GAAEf,KAAN,EAAagB,SAAQE,SAAR,GAAoBH,GAAEf,KAAtB;AACb,gBAAIe,GAAEd,OAAN,EAAee,SAAQG,QAAR,GAAmBJ,GAAEd,OAArB;AACf,gBAAIc,GAAEZ,aAAN,EAAqBa,SAAQK,cAAR,GAAyBN,GAAEZ,aAA3B;AACrBa,qBAAQd,OAAR,GAAkBa,GAAEb,OAAF,CAAUkB,MAAV,EAAlB;AACA,mBAAO,EAACE,YAAY,EAACd,MAAM,UAAP,EAAmBe,SAAS,EAACC,eAAe,SAAhB,EAA2BV,UAAU,CAACE,QAAD,CAArC,EAA5B,EAAb,EAAP;AACD,WAPD,MAOO,IAAID,GAAEhB,IAAF,IAAUgB,GAAEb,OAAZ,IAAuBa,GAAEb,OAAF,CAAUW,MAArC,EAA6C;AAClDG,qBAAQjB,IAAR,GAAegB,GAAEhB,IAAjB;AACA,gBAAIgB,GAAEf,KAAN,EAAagB,SAAQE,SAAR,GAAoBH,GAAEf,KAAtB;AACbgB,qBAAQd,OAAR,GAAkBa,GAAEb,OAAF,CAAUkB,MAAV,EAAlB;AACA,mBAAO,EAACE,YAAY,EAACd,MAAM,UAAP,EAAmBe,kCAAUC,eAAe,QAAzB,IAAsCR,QAAtC,CAAnB,EAAb,EAAP;AACD,WALM,MAKA,IAAID,GAAEhB,IAAN,EAAY;AACjB,mBAAO,EAACA,MAAMgB,GAAEhB,IAAT,EAAP;AACD,WAFM,MAEA,IAAIgB,GAAEf,KAAN,EAAa;AAClB,mBAAO,EAACsB,YAAY,EAACd,MAAM,OAAP,EAAgBe,SAAS,EAACG,KAAKX,GAAEf,KAAR,EAAzB,EAAb,EAAP;AACD;AACF;;AAED,cAAMO,MAAM,yDAAN,CAAN;AACD,OA7CD;;AA+CA,UAAMoB,QAAQf,OAAd;;AAEA,UAAI,KAAKf,aAAL,IAAsB,KAAKA,aAAL,CAAmBgB,MAA7C,EAAqD;AACnDc,cAAMC,aAAN,GAAsB,KAAK/B,aAAL,CAAmBuB,MAAnB,EAAtB;AACD;;AAED,aAAOO,KAAP;AACD;;;wBA3DY;AACX,aAAO,KAAK/B,SAAL,CAAeiB,MAAtB;AACD;;;;;kBA4DYlB,Q","file":"Elements.js","sourcesContent":["import Buttons from './Buttons';\nimport QuickReplies from './QuickReplies';\n\nclass Elements {\n  constructor() {\n    this._elements = [];\n    this._quickreplies = null;\n    this._listStyle = null;\n  }\n\n  add({text, image, subtext, buttons, defaultAction}) {\n    if (buttons) {\n      if (!(buttons instanceof Buttons)) {\n        if (Array.isArray(buttons)) {\n          buttons = Buttons.from(buttons);\n        } else {\n          throw Error('Unable to parse buttons');\n        }\n      }\n    }\n    if (defaultAction) {\n      defaultAction.type = 'web_url';\n    }\n\n\n    this._elements.push({text, image, subtext, buttons, defaultAction});\n    return this;\n  }\n\n  setQuickReplies(quickreplies) {\n    if (quickreplies) {\n      if (!(quickreplies instanceof QuickReplies)) {\n        if (Array.isArray(quickreplies)) {\n          quickreplies = QuickReplies.from(quickreplies);\n        } else {\n          throw Error('Unable to parse quickreplies');\n        }\n      }\n    }\n\n    this._quickreplies = quickreplies;\n  }\n\n  setListStyle(listStyle) {\n    if (listStyle === 'large' || listStyle === 'compact') {\n      this._listStyle = listStyle;\n    } else {\n      throw Error('Valid values for list styles are \"large\" or \"compact\"');\n    }\n  }\n\n  getQuickReplies() {\n    return this._quickreplies;\n  }\n\n  get length() {\n    return this._elements.length;\n  }\n\n  toJSON() {\n    const build = () => {\n      if (this._elements.length > 1) {\n        const elements = [];\n        for (const e of this._elements) {\n          const element = {};\n          if (e.text) element.title = e.text;\n          if (e.image) element.image_url = e.image;\n          if (e.subtext) element.subtitle = e.subtext;\n          if (e.buttons && e.buttons.length) element.buttons = e.buttons.toJSON();\n          if (e.defaultAction) element.default_action = e.defaultAction;\n          elements.push(element);\n        }\n        if (this._listStyle) {\n          return {\n            attachment: {\n              type: 'template',\n              payload: {template_type: 'list', top_element_style: this._listStyle, elements}\n            }\n          };\n        } else if (!this._listStyle) {\n          return {attachment: {type: 'template', payload: {template_type: 'generic', elements}}};\n        }\n      } else if (this._elements.length === 1) {\n        const e = this._elements[0];\n        const element = {};\n        if (e.text && e.buttons && e.buttons.length && (e.image || e.subtext)) {\n          element.title = e.text;\n          if (e.image) element.image_url = e.image;\n          if (e.subtext) element.subtitle = e.subtext;\n          if (e.defaultAction) element.default_action = e.defaultAction;\n          element.buttons = e.buttons.toJSON();\n          return {attachment: {type: 'template', payload: {template_type: 'generic', elements: [element]}}};\n        } else if (e.text && e.buttons && e.buttons.length) {\n          element.text = e.text;\n          if (e.image) element.image_url = e.image;\n          element.buttons = e.buttons.toJSON();\n          return {attachment: {type: 'template', payload: {template_type: 'button', ...element}}};\n        } else if (e.text) {\n          return {text: e.text};\n        } else if (e.image) {\n          return {attachment: {type: 'image', payload: {url: e.image}}};\n        }\n      }\n\n      throw Error('Could not form a message. Have you followed the format?');\n    };\n\n    const built = build();\n\n    if (this._quickreplies && this._quickreplies.length) {\n      built.quick_replies = this._quickreplies.toJSON();\n    }\n\n    return built;\n  }\n}\n\nexport default Elements;\n"]}