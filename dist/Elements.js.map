{"version":3,"sources":["../src/Elements.js"],"names":["Elements","_elements","_quickreplies","text","image","subtext","buttons","Array","isArray","from","Error","push","quickreplies","build","length","elements","e","element","title","image_url","subtitle","toJSON","attachment","type","payload","template_type","url","built","quick_replies"],"mappings":"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","file":"Elements.js","sourcesContent":["import Buttons from './Buttons';\nimport QuickReplies from './QuickReplies';\n\nclass Elements {\n  constructor() {\n    this._elements = [];\n    this._quickreplies = null;\n  }\n\n  add({text, image, subtext, buttons}) {\n    if (buttons) {\n      if (!(buttons instanceof Buttons)) {\n        if (Array.isArray(buttons)) {\n          buttons = Buttons.from(buttons);\n        } else {\n          throw Error('Unable to parse buttons');\n        }\n      }\n    }\n\n    this._elements.push({text, image, subtext, buttons});\n    return this;\n  }\n\n  setQuickReplies(quickreplies) {\n    if (quickreplies) {\n      if (!(quickreplies instanceof QuickReplies)) {\n        if (Array.isArray(quickreplies)) {\n          quickreplies = QuickReplies.from(quickreplies);\n        } else {\n          throw Error('Unable to parse quickreplies');\n        }\n      }\n    }\n\n    this._quickreplies = quickreplies;\n  }\n\n  getQuickReplies() {\n    return this._quickreplies;\n  }\n\n  get length() {\n    return this._elements.length;\n  }\n\n  toJSON() {\n    const build = () => {\n      if (this._elements.length > 1) {\n        const elements = [];\n        for (const e of this._elements) {\n          const element = {};\n          if (e.text) element.title = e.text;\n          if (e.image) element.image_url = e.image;\n          if (e.subtext) element.subtitle = e.subtext;\n          if (e.buttons && e.buttons.length) element.buttons = e.buttons.toJSON();\n          elements.push(element);\n        }\n        return {attachment: {type: 'template', payload: {template_type: 'generic', elements}}};\n      } else if (this._elements.length === 1) {\n        const e = this._elements[0];\n        const element = {};\n        if (e.text && e.buttons && e.buttons.length && e.image) {\n          element.title = e.text;\n          element.image_url = e.image;\n          if (e.subtext) element.subtitle = e.subtext;\n          element.buttons = e.buttons.toJSON();\n          return {attachment: {type: 'template', payload: {template_type: 'generic', elements: [element]}}};\n        } else if (e.text && e.buttons && e.buttons.length) {\n          element.text = e.text;\n          if (e.image) element.image_url = e.image;\n          element.buttons = e.buttons.toJSON();\n          return {attachment: {type: 'template', payload: {template_type: 'button', ...element}}};\n        } else if (e.text) {\n          return {text: e.text};\n        } else if (e.image) {\n          return {attachment: {type: 'image', payload: {url: e.image}}};\n        }\n      }\n\n      throw Error('Could not form a message. Have you followed the format?');\n    };\n\n    const built = build();\n\n    if (this._quickreplies && this._quickreplies.length) {\n      built.quick_replies = this._quickreplies.toJSON();\n    }\n\n    return built;\n  }\n}\n\nexport default Elements;\n"]}