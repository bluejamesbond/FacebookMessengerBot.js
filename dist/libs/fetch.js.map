{"version":3,"sources":["../../src/libs/fetch.js"],"names":["fetch","url","opts","resolve","reject","body","json","headers","method","req","toLowerCase","query","send","credentials","withCredentials","k","v","set","end","err","res","response","error","status","_method","path","text","Object","defineProperty","value","enumerable","configurable","e","ee","test","JSON","parse","trim"],"mappings":"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","file":"fetch.js","sourcesContent":["import request from 'superagent';\r\n\r\nexport default function fetch(url, opts = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    if (typeof opts.body === 'object' || opts.json) {\r\n      opts.headers = Object.assign({'Content-Type': 'application/json'}, opts.headers || {});\r\n    }\r\n\r\n    const method = opts.method || 'get';\r\n    let req = request[method.toLowerCase()](url);\r\n\r\n    req = req.query(opts.query);\r\n\r\n    if (opts.method === 'get') {\r\n      req = req.query(opts.body);\r\n    } else {\r\n      req = req.send(opts.body);\r\n    }\r\n\r\n    if (opts.credentials) {\r\n      req = req.withCredentials();\r\n    }\r\n\r\n    if (opts.headers) {\r\n      for (const [k, v] of Object.entries(opts.headers)) {\r\n        req = req.set(k, v);\r\n      }\r\n    }\r\n\r\n    req.end((err, res) => {\r\n      if (err) {\r\n        try {\r\n          if (err.response && err.response.error) {\r\n            err = err.response.error;\r\n          } else if (res.error) {\r\n            err = res.error;\r\n          }\r\n\r\n          const {status, method: _method, path, text} = err;\r\n\r\n          Object.defineProperty(err, 'res', {value: res, enumerable: false, configurable: false});\r\n          Object.defineProperty(err, 'status', {value: status, enumerable: false, configurable: false});\r\n          Object.defineProperty(err, 'method', {value: _method, enumerable: false, configurable: false});\r\n          Object.defineProperty(err, 'path', {value: path, enumerable: false, configurable: false});\r\n          Object.defineProperty(err, 'text', {value: text, enumerable: false, configurable: false});\r\n        } catch (e) {\r\n          try {\r\n            Object.defineProperty(err, 'res', {value: res, enumerable: false, configurable: false});\r\n          } catch (ee) {\r\n            // fallback for crappy browsers\r\n            err.res = res;\r\n          }\r\n        }\r\n\r\n        reject(err);\r\n      } else {\r\n        if ((opts.json || /\\/json/g.test(res.headers['Content-Type'])) && res.text) {\r\n          try {\r\n            res.body = JSON.parse(res.text.trim());\r\n          } catch (e) {\r\n            // ignore\r\n          }\r\n        }\r\n\r\n        resolve(res);\r\n      }\r\n    });\r\n  });\r\n}\r\n"]}